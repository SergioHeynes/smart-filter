<div class="mb-10">
    <!-- <p>
        CONFIG: 
        {{config | json}}
    </p> -->
    
    <!-- <p>
        FORM: 
        {{filterForm.value | json}}
    </p> -->
    
    
    <p>
        FILTERS:
        {{filters.value | json}}
    </p>
    
    <!-- <p>
        FILTER SELECTED CONTROL:
        {{filterOptionsMenu.value | json}}
    </p> -->
</div>


<div>

    <div [formGroup]="filterForm">

        <ng-container formArrayName="filters">

            <ng-container *ngFor="let filterControl of filters.controls; let i = index">
                <div class="flex gap-4" [formGroupName]="i">
                
                    <!-- <mat-form-field appearance="fill">
                        <input matInput formControlName="displayName" placeholder="filter displayName">
                    </mat-form-field> -->

                    <label for="">Nombre: </label>

                    <mat-form-field>
                        <mat-select [formControl]="filterOptionsMenu" (selectionChange)="filterOptionsChange($event.value, i)">
                          <mat-option *ngFor="let field of config.fields" [value]="field">
                            {{field.displayName}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>

                      <!-- <mat-form-field>
                        <mat-select [formControl]="filterOptionsMenu" (selectionChange)="filterOptionsChange($event.value, i)">
                          <mat-option value="Elemento 1">
                            Elemento 1
                          </mat-option>
                          <mat-option value="Elemento 2">
                            Elemento 2
                          </mat-option>
                          <mat-option value="Elemento 3">
                            Elemento 3
                          </mat-option>
                        </mat-select>
                      </mat-form-field> -->




                      <mat-form-field>
                        <mat-select formControlName="filterOperator">
                          <mat-option *ngFor="let option of filterControl.get('queryOptions')?.value" [value]="option">
                            {{option}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>

                    <!-- HTML element according field type -->
                    <ng-container [ngSwitch]="filterControl.get('dataType')?.value">
                        <div *ngSwitchCase="'text'">
                          <mat-form-field>
                            <mat-label>Texto</mat-label>
                            <input type="text" matInput formControlName="value">
                          </mat-form-field>
                        </div>
                        <div *ngSwitchCase="'number'">is number
                          <input type="number" matInput formControlName="value">
                        </div>
                        <div *ngSwitchCase="'date'">
                          <div *ngIf="filterControl.get('filterOperator')?.value !== 'entre'">
                            <mat-form-field>
                              <input 
                              matInput [matDatepicker]="picker"
                              readonly="true"
                              formControlName="value">
                              <mat-hint>DD/MM/YYYY</mat-hint>
                              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                              <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                          </div>
                          <mat-form-field *ngIf="filterControl.get('filterOperator')?.value === 'entre'">
                            <mat-label>Elige un rango de fechas</mat-label>
                            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                              <input matStartDate formControlName="start" placeholder="Start date" (dateInput)="setDates(i, 'start')">
                              <input matEndDate formControlName="end" placeholder="End date" (dateInput)="setDates(i, 'end')">
                            </mat-date-range-input>
                            <mat-hint>DD/MM/YYYY – DD/MM/YYYY</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-date-range-picker #picker></mat-date-range-picker>
                          </mat-form-field>
                        </div>
                        <div *ngSwitchCase="'dropdown'">
                          <mat-form-field>
                            <mat-label>Dropdown</mat-label>
                            <mat-select formControlName="value">
                              <mat-option *ngFor="let option of filterControl.get('optionList')?.value let i = index" 
                              [value]="option">{{option}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        </div>
                        <div *ngSwitchCase="'checklist'">is checklist</div>
                        <div *ngSwitchCase="'multi-dropdown'">

                            <mat-form-field>
                                <mat-label>Valores</mat-label>
                                <mat-select formControlName="value" multiple>
                                  <mat-option *ngFor="let option of filterControl.get('optionList')?.value" [value]="option._id">{{option.displayName}}</mat-option>
                                </mat-select>
                            </mat-form-field>

                        </div>
                        
                        <div *ngSwitchDefault>...</div>
                    </ng-container>

                    <!-- <mat-form-field appearance="fill">
                        <input #elInput matInput formControlName="value" placeholder="filter values" (keyup.enter)="setValue(i)">
                    </mat-form-field> -->

<!-- 
                    
                        <mat-select placeholder="Elige una opción">
                            <mat-option [value]="option._id" *ngFor="let option of config.filterOptionsMenu">{{option.displayName}}</mat-option>
                        </mat-select> -->

                        
                    <mat-icon class="delete-btn" (click)="deleteFilter(i)">
                        delete_forever</mat-icon>
                </div>
            </ng-container>
        </ng-container>

    </div>

    <button [type]="'button'" (click)="addFilter()">+ Agregar filtro</button>
</div>

<div class="mt-10">
    <button class="border border-gray-300 px-2 py-2" [type]="'button'" (click)="filter()">Aplicar filtro</button>
</div>